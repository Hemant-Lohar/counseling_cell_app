import 'dart:developer';
import 'dart:io';
import 'package:dart_tensor/dart_tensor.dart';
import 'package:flutter/material.dart';
import 'package:firebase_ml_model_downloader/firebase_ml_model_downloader.dart';
import 'package:tflite_flutter/tflite_flutter.dart';
TextEditingController _textcontroller = TextEditingController();

class Ml extends StatefulWidget {

  const Ml({
    super.key,
  });

  @override
  _MlState createState() => _MlState();
}

class _MlState extends State<Ml> {
  _MlState();
  @override
  Widget build(BuildContext context) {

    FirebaseModelDownloader.instance
        .getModel(
      "test_model",
      FirebaseModelDownloadType.latestModel,
      //Don't delete following lines , i'll need'em later bitch !
      /*FirebaseModelDownloadConditions(
          androidChargingRequired: false,
          androidWifiRequired: false,
          androidDeviceIdleRequired: false,
        )*/
    ).then((customModel){
      // Download complete. Depending on your app, you could enable the ML
      // feature, or switch from the local model to the remote model, etc.

      // The CustomModel object contains the local path of the model file,
      // which you can use to instantiate a TensorFlow Lite interpreter.
      //final localModelPath = customModel.file;


      //interpreter.run(ip,op);
     // _textcontroller.text = op.toString();
      List result = predict(customModel);
      _textcontroller.text = result.toString();
    });

    return Scaffold(
        backgroundColor: Colors.blueGrey,
        appBar: AppBar(
          title: const Text(
            "Testing page for ML",
            style: TextStyle(
              color: Colors.black,
            ),
          ),
          backgroundColor: Colors.transparent,
          elevation: 0,
        ),
        body: Padding(
          padding: const EdgeInsets.all(36.0),
          child: Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              crossAxisAlignment: CrossAxisAlignment.stretch,
              children: [
                TextField(
                  controller: _textcontroller,
                  decoration: const InputDecoration(
                    hintText: "Output here",
                  ),
                )
              ],
            ),
          ),
        ));
  }

List<dynamic> predict(FirebaseCustomModel x){
    final interpreter = Interpreter.fromFile(x.file);
    DartTensor dt = DartTensor();
  //List ipfloat = [255, 254, 255, 254, 254, 179, 122, 107, 95, 124, 149, 150, 169, 178, 179, 179, 181, 181, 184, 190, 191, 191, 193, 190, 190, 195, 194, 192, 193, 196, 193, 192, 188, 182, 173, 162, 152, 144, 129, 116, 113, 106, 184, 255, 252, 254, 255, 255, 255, 254, 254, 255, 238, 146, 122, 108, 126, 148, 167, 172, 179, 182, 184, 185, 184, 185, 186, 188, 189, 191, 188, 190, 192, 192, 192, 192, 194, 194, 194, 193, 187, 182, 179, 176, 168, 159, 146, 126, 120, 118, 148, 247, 253, 253, 255, 255, 255, 254, 253, 255, 212, 141, 125, 129, 153, 168, 172, 179, 182, 183, 187, 185, 185, 187, 188, 190, 192, 190, 192, 194, 193, 192, 190, 189, 191, 193, 191, 188, 186, 182, 178, 175, 171, 170, 164, 141, 114, 122, 125, 215, 255, 252, 255, 255, 254, 253, 253, 252, 191, 136, 123, 149, 171, 172, 176, 176, 179, 184, 186, 184, 182, 181, 178, 181, 183, 183, 187, 187, 186, 185, 185, 187, 187, 188, 185, 182, 179, 175, 176, 175, 174, 172, 173, 159, 112, 114, 124, 180, 255, 252, 255, 254, 253, 252, 254, 239, 171, 132, 130, 159, 177, 170, 169, 174, 177, 175, 175, 179, 180, 181, 182, 185, 188, 189, 188, 188, 189, 188, 185, 185, 184, 185, 182, 180, 177, 177, 173, 168, 171, 172, 170, 163, 118, 110, 127, 155, 244, 254, 254, 254, 253, 251, 253, 238, 165, 136, 133, 164, 177, 173, 171, 167, 167, 169, 172, 171, 173, 172, 173, 175, 182, 185, 184, 187, 187, 186, 183, 180, 179, 175, 171, 169, 169, 169, 167, 166, 168, 167, 167, 159, 120, 102, 124, 140, 225, 255, 254, 254, 253, 252, 255, 232, 164, 133, 132, 163, 177, 169, 163, 159, 160, 163, 164, 169, 174, 176, 178, 181, 186, 187, 185, 187, 186, 185, 184, 181, 180, 178, 179, 177, 174, 172, 167, 167, 164, 165, 164, 153, 117, 102, 120, 127, 205, 255, 253, 254, 253, 252, 255, 231, 155, 128, 138, 163, 176, 158, 154, 155, 161, 165, 169, 175, 177, 178, 182, 180, 182, 182, 184, 184, 184, 183, 187, 189, 191, 190, 189, 190, 189, 188, 186, 184, 175, 164, 161, 156, 114, 101, 110, 123, 190, 255, 253, 254, 254, 252, 255, 231, 146, 132, 137, 165, 169, 159, 172, 175, 175, 177, 179, 182, 184, 186, 189, 184, 185, 187, 188, 186, 188, 190, 192, 195, 194, 191, 179, 176, 175, 178, 185, 180, 176, 174, 164, 153, 117, 100, 102, 119, 188, 255, 254, 254, 254, 252, 255, 234, 151, 138, 135, 164, 172, 173, 174, 169, 163, 157, 150, 156, 171, 180, 188, 191, 189, 190, 190, 189, 191, 191, 193, 195, 185, 167, 146, 137, 130, 128, 143, 155, 152, 162, 170, 160, 115, 96, 98, 114, 179, 255, 254, 255, 254, 252, 255, 237, 157, 144, 130, 165, 179, 159, 137, 119, 103, 113, 125, 132, 141, 156, 177, 190, 192, 190, 192, 193, 193, 194, 195, 188, 166, 158, 152, 144, 129, 123, 102, 109, 130, 146, 164, 167, 116, 92, 102, 116, 164, 251, 255, 254, 253, 251, 254, 237, 163, 143, 128, 166, 169, 135, 110, 94, 104, 119, 132, 144, 150, 151, 169, 183, 191, 193, 190, 190, 193, 192, 188, 176, 163, 159, 157, 148, 134, 136, 138, 148, 161, 158, 159, 172, 120, 94, 102, 118, 150, 247, 255, 254, 253, 252, 255, 232, 165, 145, 128, 175, 156, 148, 155, 155, 156, 147, 137, 144, 156, 155, 159, 173, 184, 187, 188, 186, 186, 185, 178, 171, 158, 152, 147, 138, 143, 162, 172, 178, 175, 175, 161, 173, 129, 91, 104, 120, 146, 244, 255, 254, 253, 252, 255, 228, 165, 145, 129, 179, 166, 171, 170, 166, 161, 149, 141, 131, 137, 145, 152, 166, 178, 178, 183, 183, 179, 177, 171, 162, 149, 138, 131, 132, 139, 140, 141, 151, 163, 169, 168, 165, 150, 94, 103, 119, 139, 240, 254, 252, 253, 252, 255, 229, 168, 136, 136, 183, 177, 173, 163, 149, 135, 127, 124, 122, 122, 123, 131, 146, 165, 171, 178, 178, 175, 170, 160, 142, 125, 121, 112, 101, 91, 92, 103, 115, 123, 145, 158, 158, 168, 119, 98, 119, 131, 229, 252, 247, 253, 251, 255, 219, 174, 138, 150, 187, 171, 160, 137, 107, 82, 73, 64, 69, 88, 105, 106, 112, 139, 157, 172, 180, 178, 162, 141, 118, 109, 104, 90, 81, 91, 115, 112, 109, 121, 112, 135, 146, 168, 149, 105, 117, 124, 216, 255, 255, 254, 250, 254, 219, 169, 139, 163, 187, 155, 133, 102, 88, 88, 124, 135, 107, 77, 83, 94, 96, 110, 134, 165, 193, 187, 161, 138, 115, 104, 95, 90, 118, 165, 161, 152, 153, 117, 116, 106, 132, 165, 168, 121, 118, 115, 203, 237, 211, 254, 251, 255, 211, 150, 144, 172, 186, 145, 116, 97, 111, 168, 165, 140, 173, 161, 95, 93, 105, 111, 129, 162, 195, 192, 170, 151, 126, 122, 108, 112, 161, 137, 72, 89, 153, 160, 100, 119, 136, 162, 176, 145, 123, 116, 151, 163, 158, 255, 247, 231, 200, 145, 152, 176, 185, 143, 121, 96, 147, 168, 67, 50, 108, 172, 134, 102, 138, 140, 142, 159, 188, 186, 171, 162, 158, 156, 140, 121, 145, 100, 35, 51, 99, 173, 121, 123, 140, 153, 174, 160, 134, 124, 144, 170, 151, 253, 228, 167, 157, 152, 154, 182, 181, 140, 126, 123, 158, 135, 59, 26, 80, 159, 145, 121, 144, 156, 146, 156, 185, 180, 170, 163, 166, 148, 141, 118, 135, 114, 68, 68, 137, 153, 134, 135, 148, 154, 171, 168, 143, 138, 174, 164, 145, 253, 200, 177, 178, 162, 157, 188, 179, 141, 132, 136, 149, 146, 101, 88, 115, 142, 122, 125, 131, 147, 143, 158, 177, 175, 168, 156, 158, 145, 118, 116, 116, 126, 126, 136, 146, 144, 144, 148, 154, 159, 163, 166, 153, 148, 174, 161, 150, 255, 170, 164, 205, 171, 166, 190, 176, 150, 141, 139, 138, 139, 135, 126, 126, 127, 131, 129, 145, 148, 141, 161, 173, 177, 172, 157, 157, 167, 145, 127, 130, 135, 132, 134, 137, 146, 150, 155, 158, 163, 164, 167, 158, 152, 170, 161, 148, 249, 178, 163, 196, 180, 178, 189, 169, 157, 146, 143, 139, 133, 130, 132, 137, 140, 144, 155, 160, 149, 145, 164, 171, 180, 175, 162, 159, 173, 174, 155, 144, 146, 151, 155, 154, 159, 161, 162, 164, 165, 163, 169, 168, 155, 151, 171, 155, 247, 179, 172, 184, 181, 192, 185, 168, 161, 156, 155, 152, 150, 150, 146, 140, 151, 161, 163, 158, 152, 153, 162, 174, 176, 168, 162, 159, 168, 174, 170, 159, 150, 148, 158, 166, 171, 174, 169, 168, 166, 164, 169, 179, 149, 135, 176, 167, 251, 183, 182, 167, 146, 201, 185, 168, 165, 163, 164, 165, 161, 153, 147, 155, 169, 167, 166, 165, 157, 157, 165, 182, 180, 167, 165, 162, 167, 174, 176, 175, 164, 159, 162, 164, 170, 175, 172, 168, 161, 162, 173, 190, 159, 145, 161, 173, 254, 208, 186, 154, 125, 198, 188, 167, 168, 168, 169, 168, 162, 158, 163, 169, 171, 167, 169, 159, 160, 158, 164, 185, 182, 166, 163, 166, 165, 171, 176, 179, 175, 171, 173, 167, 169, 172, 170, 165, 160, 160, 174, 191, 165, 166, 158, 166, 254, 230, 176, 134, 137, 194, 189, 165, 170, 170, 169, 169, 164, 167, 171, 169, 166, 167, 167, 156, 156, 158, 167, 184, 189, 172, 160, 162, 164, 169, 173, 179, 178, 172, 174, 174, 170, 167, 163, 162, 160, 158, 177, 190, 170, 186, 175, 163, 255, 238, 162, 138, 167, 188, 188, 166, 169, 167, 169, 170, 169, 168, 168, 167, 167, 168, 164, 152, 152, 158, 168, 184, 185, 173, 165, 159, 155, 162, 175, 173, 177, 175, 167, 166, 169, 162, 163, 160, 157, 158, 175, 191, 174, 174, 166, 165, 255, 239, 155, 138, 170, 191, 188, 169, 164, 161, 168, 170, 168, 166, 165, 170, 168, 166, 152, 146, 154, 160, 167, 174, 179, 169, 161, 157, 156, 148, 166, 172, 173, 175, 170, 164, 166, 164, 160, 156, 155, 156, 171, 183, 169, 158, 161, 162, 254, 242, 181, 148, 147, 187, 188, 169, 165, 161, 165, 170, 167, 163, 169, 171, 168, 152, 136, 148, 157, 162, 165, 171, 176, 172, 161, 155, 158, 151, 138, 158, 175, 168, 167, 167, 162, 162, 158, 153, 155, 156, 170, 179, 170, 160, 167, 165, 254, 245, 196, 191, 156, 184, 186, 167, 168, 159, 157, 161, 163, 160, 166, 170, 155, 133, 148, 158, 162, 162, 165, 169, 171, 169, 155, 153, 160, 160, 140, 119, 156, 169, 162, 163, 163, 159, 159, 154, 154, 159, 169, 174, 181, 163, 170, 171, 253, 252, 209, 189, 171, 194, 186, 165, 166, 159, 152, 155, 157, 158, 163, 159, 124, 131, 151, 144, 101, 117, 153, 151, 159, 151, 106, 79, 115, 148, 143, 128, 107, 156, 163, 158, 160, 160, 159, 157, 156, 157, 166, 173, 186, 176, 167, 203, 253, 255, 228, 184, 176, 198, 188, 164, 164, 159, 149, 150, 150, 154, 163, 131, 115, 136, 133, 106, 64, 78, 130, 130, 130, 121, 102, 94, 103, 125, 148, 154, 110, 119, 163, 159, 156, 154, 156, 152, 155, 158, 166, 177, 184, 161, 189, 247, 253, 254, 248, 201, 168, 197, 190, 169, 162, 158, 148, 144, 146, 152, 151, 110, 127, 148, 146, 128, 131, 126, 120, 118, 113, 117, 131, 147, 141, 149, 159, 152, 143, 99, 140, 159, 154, 152, 152, 152, 154, 156, 165, 186, 186, 197, 247, 252, 254, 253, 253, 249, 207, 200, 196, 172, 164, 154, 147, 145, 147, 151, 129, 109, 143, 145, 152, 140, 131, 126, 115, 104, 107, 121, 128, 129, 135, 151, 152, 149, 155, 120, 115, 158, 150, 150, 153, 153, 150, 153, 166, 202, 250, 255, 254, 253, 254, 254, 253, 254, 255, 237, 199, 176, 167, 153, 143, 145, 148, 146, 110, 123, 146, 142, 151, 146, 135, 125, 121, 127, 134, 135, 134, 137, 142, 148, 154, 152, 152, 140, 107, 148, 149, 147, 152, 150, 150, 153, 173, 216, 254, 252, 255, 254, 255, 254, 254, 254, 251, 249, 210, 179, 172, 157, 146, 143, 152, 135, 102, 130, 137, 143, 152, 150, 147, 144, 150, 148, 147, 149, 153, 155, 151, 147, 145, 142, 141, 146, 121, 132, 152, 147, 150, 151, 155, 152, 181, 233, 254, 253, 255, 254, 255, 254, 255, 255, 252, 253, 227, 184, 178, 165, 147, 141, 154, 126, 109, 130, 136, 144, 155, 159, 161, 163, 162, 160, 162, 167, 170, 167, 162, 154, 146, 134, 134, 145, 132, 125, 149, 144, 146, 155, 155, 151, 196, 248, 253, 253, 255, 254, 255, 254, 255, 255, 252, 252, 242, 197, 182, 175, 147, 143, 156, 121, 120, 133, 144, 151, 154, 160, 155, 147, 146, 145, 151, 155, 157, 158, 157, 153, 149, 139, 134, 139, 135, 126, 145, 146, 146, 160, 153, 153, 218, 255, 252, 254, 255, 254, 255, 254, 255, 255, 254, 252, 253, 210, 187, 185, 150, 144, 156, 119, 130, 137, 151, 156, 141, 137, 131, 129, 126, 119, 126, 134, 137, 137, 132, 134, 141, 146, 143, 139, 137, 132, 141, 143, 152, 165, 149, 168, 241, 255, 253, 254, 255, 255, 255, 254, 255, 255, 254, 253, 255, 228, 186, 194, 154, 142, 159, 122, 126, 139, 153, 147, 124, 117, 110, 103, 106, 105, 105, 112, 112, 107, 104, 114, 120, 127, 144, 142, 139, 128, 135, 144, 156, 163, 145, 188, 251, 254, 254, 254, 255, 255, 255, 254, 255, 255, 254, 253, 254, 248, 197, 194, 164, 142, 158, 127, 122, 128, 134, 116, 84, 69, 49, 56, 85, 124, 111, 104, 84, 64, 48, 55, 73, 104, 126, 132, 130, 122, 139, 149, 159, 155, 153, 206, 252, 254, 253, 254, 255, 255, 255, 254, 255, 255, 254, 253, 252, 255, 222, 192, 174, 142, 161, 125, 128, 134, 120, 62, 19, 21, 26, 28, 30, 43, 38, 37, 39, 36, 32, 25, 18, 56, 117, 138, 138, 138, 148, 151, 161, 149, 170, 216, 253, 253, 253, 254, 255, 255, 255, 254, 255, 255, 254, 253, 253, 254, 235, 192, 182, 148, 163, 128, 130, 134, 100, 38, 24, 20, 28, 35, 41, 47, 45, 52, 57, 53, 42, 28, 22, 27, 95, 140, 139, 138, 144, 154, 156, 151, 181, 220, 255, 253, 253, 254, 255, 255, 255, 254, 255, 255, 253, 253, 252, 254, 238, 187, 186, 155, 160, 120, 122, 127, 77, 49, 54, 35, 35, 54, 59, 70, 70, 78, 81, 75, 67, 44, 34, 42, 74, 122, 124, 125, 129, 151, 152, 153, 180, 229, 255, 252, 253, 254, 255, 255, 255, 254, 255, 255, 253, 252, 250, 253, 247, 176, 185, 163, 159, 128, 116, 132, 79, 65, 77, 40, 35, 65, 80, 96, 86, 89, 99, 95, 94, 66, 52, 52, 59, 117, 133, 137, 145, 162, 152, 161, 180, 239, 255, 253, 253, 254, 255, 255, 255, 254, 255, 255, 254, 253, 252, 252, 251, 181, 174, 170, 160, 134, 114, 133, 104, 68, 83, 75, 59, 88, 100, 107, 99, 105, 111, 112, 116, 86, 85, 78, 75, 124, 131, 134, 146, 166, 158, 174, 183, 246, 254, 253, 253, 254, 255, 255, 255, 254, 255, 255, 254, 252, 253, 251, 251, 190, 169, 171, 160, 138, 115, 131, 109, 58, 92, 115, 85, 105, 106, 109, 108, 117, 120, 114, 121, 98, 116, 91, 100, 122, 118, 113, 129, 160, 160, 176, 188, 251, 252, 253, 253, 254, 255, 255];
    List ip = dt.random.random([1,48,48,1],start: 0, end: 1,dtype: 'double');
  /*List ip = ipfloat.reshape(ipint, [1,48,48,1]);
 //
  log(dt.shape(ip).toString());
  List op = dt.zeros([1,7]);
  log(dt.shape(op).toString());*/
    List op = [0,0,0,0,1,0,0];
    interpreter.run(ip,op);

  return op;
}
}
